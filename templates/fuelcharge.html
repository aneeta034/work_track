{% extends 'technician_dashboard.html' %}
{% block title %}
fuelcharge
{% endblock %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
{% block content %}
<style>
  .custom-navbar{
      width:1288px; /* Ensure both navbar and table have the same width */
      margin-left: auto; /* Push both to the right */
      margin-right: 0;
  }

 
 
  
</style>

<!-- Remove the container around navbar -->
<div class="mt-0">
    <nav class="navbar navbar-expand-lg bg-light shadow rounded custom-navbar" style="max-width: 85%; margin-top: 5px; margin-left: auto;">
    <div class="container-fluid">
        
        <!-- Selected Page Title (Only Visible in Mobile View) -->
        <span class="navbar-brand d-lg-none fw-bold" id="selectedPageTitle"></span>

        <!-- Back Button (Visible Only on Desktop) -->
        <a class="nav-link d-none d-lg-block" href="{% url 'technician_dashboard' %}">
            <i class="bi bi-arrow-left"></i>
        </a>

        <!-- Navbar Toggle Button (Right-Aligned) -->
        <button class="navbar-toggler ms-auto" type="button" id="navbarToggle">
            <span class="navbar-toggler-icon"></span>
        </button>

        <!-- Navbar Links -->
        <div class="collapse navbar-collapse" id="vendorNav">
            <ul class="navbar-nav d-flex flex-wrap gap-2">
                <li class="nav-item">
                    <a class="nav-link {% if request.resolver_match.url_name == 'fuelcharge' %}fw-bold active{% endif %}" href="{% url 'fuelcharge' apply.id %}" data-title="Fuel Charge">Fuel Charge</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.resolver_match.url_name == 'food_allowance' %}fw-bold active{% endif %}" href="{% url 'food_allowance' apply.id %}" data-title="Food Allowance">Food Allowance</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.resolver_match.url_name == 'item_purchased' %}fw-bold active{% endif %}" href="{% url 'item_purchased' apply.id %}" data-title="Item Purchased">Item Purchased</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.resolver_match.url_name == 'vendor_info' %}fw-bold active{% endif %}" href="{% url 'vendor_info' apply.id %}" data-title="Vendor Info">Vendor Info</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

  <div class="container custom-container" style="max-width: 85%; margin-top: 5px; margin-right: unset;">
    <div class="card p-4">
        <div class="card-body">
            <form action="{% url 'fuelcharge' apply.id %}" method="post">
                {% csrf_token %}
                <div class="row">
                    <div class="col-md-3">
                        <label for="technician_name">Technician Name</label>
                        <input type="text" class="form-control" id="technician_name" name="technician_name" value="{{ technician_name }}" required />
                    </div>
                    <div class="col-md-3">
                        <label for="date">Date</label>
                        <input type="date" class="form-control" name="date" id="date" />
                    </div>
                    <div class="col-md-3">
                        <label for="purpose">Purpose</label>
                        <input type="text" class="form-control" id="purpose" name="purpose" />
                    </div>
                    <div class="col-md-3">
                        <label for="kilometers">Kilometers</label>
                        <input type="number" class="form-control" id="kilometers" name="kilometers" />
                    </div>
                </div>
                <div class="d-flex justify-content-end mt-3">
                    <button class="btn btn-primary" type="submit">Add</button>
                </div>
            </form>
        </div>
    </div>
</div>
</div>
  

                    <div class="table-responsive mt-4 "  style="max-width: 85%; margin-top: 5px; margin-left: auto;">
                      {% if fuel_charges %}
                        <table id="basic-datatables" class="table table-striped table-bordered">
                          <thead>
                            <tr>
                              <th scope="col">Customer Name</th>
                              <th scope="col">Issue</th>
                              <th scope="col">Technician Name</th>
                              <th scope="col">Date</th>
                              <th scope="col">Purpose</th>
                              <th scope="col">Kilometer</th>
                              <th scope="col">Cost</th>
                              <th scope="col">Actions</th>
                            </tr>
                           
                          </thead>
                          {% for d in fuel_charges %}
                        <tr>
                            <td>{{ d.customer_name }}</td>
                            <td>{{ d.issue }}</td>
                            <td>{{ d.technician_name }}</td>
                            <td>{{ d.date }}</td>
                            <td>{{ d.purpose }}</td>
                            <td>{{ d.kilometers }}</td>
                            <td>{{ d.cost }}</td>
                            <td>
                    <div style="display: flex; align-items: center;">
                    <a href="{% url 'update_fuelcharge' d.id %}" class="edit-fuel-btn" data-bs-toggle="modal" data-bs-target="#updateFuelModal{{ d.id }}">
                        <i class="fa fa-pencil-alt" aria-hidden="true" title="Update"></i>
                    </a>
            <!-- Delete Button (Triggers Modal) -->
            <form action="{% url 'delete_fuelcharge' d.id %}" method="post" style="display: inline;">
                {% csrf_token %}
                <button type="button" class="icon-link delete-icon" title="Delete" data-bs-toggle="modal" data-bs-target="#deleteFuelChargeModal{{ d.id }}">
                    <i class="fa fa-trash" aria-hidden="true"></i>
                </button>
            </form>

            <!-- Delete Confirmation Modal -->
            <div class="modal fade" id="deleteFuelChargeModal{{ d.id }}" tabindex="-1" aria-labelledby="deleteFuelChargeLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Confirm Delete</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <p>Are you sure you want to delete this fuel charge?</p>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            
                            <!-- Delete Form (Confirmed on Click) -->
                            <form action="{% url 'delete_fuelcharge' d.id %}" method="post">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger">Delete</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </td>
</tr>

                            {% endfor %}
                       </tbody>
                    </table>

<!--update_fuelcharge Modal -->
{% for d in fuel_charges %}
<div class="modal fade" id="updateFuelModal{{ d.id }}" tabindex="-1" aria-labelledby="updateFuelModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Update Fuel Charge</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="POST" action="{% url 'update_fuelcharge' d.id %}">
                    {% csrf_token %}
                    
                    <input type="hidden" name="fuel_id" value="{{ d.id }}">

                    <div class="mb-3">
                        <label class="form-label">Technician Name</label>
                        <input type="text" class="form-control" name="technician_name" value="{{ d.technician_name }}">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Date</label>
                        <input type="date" class="form-control" name="date" value="{{ d.date|date:'Y-m-d' }}">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Purpose</label>
                        <input type="text" class="form-control" name="purpose" value="{{ d.purpose }}">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Kilometers</label>
                        <input type="number" class="form-control" name="kilometers" value="{{ d.kilometers }}">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Cost</label>
                        <input type="number" step="0.01" class="form-control" name="cost" value="{{ d.cost }}">
                    </div>

                    <button type="submit" class="btn btn-primary">Update</button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endfor %}

                        {% else %}
<div class="alert alert-warning text-center">
    No fuel charge available. Please add data.
</div>
{% endif %}
                    </div> 
                </div>
            </div>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        let toggleButton = document.getElementById("navbarToggle");
        let navbarMenu = document.getElementById("vendorNav");
        let selectedPageTitle = document.getElementById("selectedPageTitle");

        // Find the currently active menu item and set its text as the title
        let activeItem = document.querySelector(".nav-link.active");
        if (activeItem) {
            selectedPageTitle.textContent = activeItem.getAttribute("data-title");
        }

        // Toggle navbar on button click
        toggleButton.addEventListener("click", function () {
            navbarMenu.classList.toggle("show");
        });

        // Close navbar when clicking outside
        document.addEventListener("click", function (event) {
            let isClickInside = navbarMenu.contains(event.target) || toggleButton.contains(event.target);
            if (!isClickInside) {
                navbarMenu.classList.remove("show");
            }
        });
    });
</script>

{% endblock %}